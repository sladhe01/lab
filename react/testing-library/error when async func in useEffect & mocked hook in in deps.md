useHistory 훅 전체를 모킹하고 테스트를 하는데 테스트가 끝나지 않고 메모리 용량 한계에 다달아 비정상 종료되는 에러를 발견했다. 많은 데이터를 다루는 테스트도 아니기 떄문에 메모리가 부족할 것 같지 않았고 메모리 누수가 발생하는 것으로 판단했다. 여러 조건에서 실험을 해봤더니 비동기 함수가 useEffect 안에 있고 모킹된 훅이 deps에 있는 조건에서 발생했다. 아마도 모킹된 훅이 참조하는 객체가 매 렌더링마다 새로운 참조를 생성하고 이에 따라 useEffect가 계속 호출되고 Promise가 쌓여 메모리를 점유함으로 인해 생긴 현상이라고 추측해본다.
그래서 이런경우에는 불가피한 경우가 아니라면 모킹을 자제하는 것이 좋을 듯하다.